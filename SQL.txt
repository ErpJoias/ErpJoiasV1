'SELECT ' +
         'CASE WHEN M.ID_TRANSPROD > 0 THEN ''TRANSFERÊNCIA '' || M.ID_TRANSPROD ' +
         'WHEN M.ID_VENDA_DIRETA > 0 THEN ''VENDA DIRETA '' || M.ID_VENDA_DIRETA ' +
         'WHEN M.ID_TRANSACAO_PRODUTO > 0 THEN ' +
         '  CASE WHEN L.ID_LOTE > 0 THEN L.LOTE ELSE ''TP. '' || M.ID_TRANSACAO_PRODUTO END ' +
         'ELSE ''MOV. '' || M.ID_MOVIMENTO_ESTOQUE_PROD END DOCUMENTO, ' +
         'MIN(CASE WHEN M.ID_TRANSPROD > 0 THEN TP.DATA_TRANS ELSE M.DATA END) DATA, ' +
         'SUM(CASE WHEN TIPO = ''C'' THEN M.QUANTIDADE ELSE CAST(0 AS INTEGER) END) ENTRADA_QTDE, ' +
         'SUM(CASE WHEN TIPO = ''C'' THEN (M.QUANTIDADE * E.VALOR_PRODUTO_VENDA) ELSE CAST(0 AS DOUBLE PRECISION) END) ENTRADA_VALOR, ' +
         'SUM(CASE WHEN TIPO = ''C'' THEN (M.QUANTIDADE * M.VALOR) ELSE CAST(0 AS DOUBLE PRECISION) END) ENTRADA_VALOR_DOC, ' +
         'SUM(CASE WHEN TIPO = ''D'' THEN M.QUANTIDADE ELSE CAST(0 AS INTEGER) END) SAIDA_QTDE, ' +
         'SUM(CASE WHEN TIPO = ''D'' THEN (M.QUANTIDADE * E.VALOR_PRODUTO_VENDA) ELSE CAST(0 AS DOUBLE PRECISION) END) SAIDA_VALOR, ' +
         'SUM(CASE WHEN TIPO = ''D'' THEN (M.QUANTIDADE * M.VALOR) ELSE CAST(0 AS DOUBLE PRECISION) END) SAIDA_VALOR_DOC ' +
         'FROM MOVIMENTO_ESTOQUE_PROD M ' +
         'JOIN PRODUTO_CODIGO_BARRA CB ON M.ID_PRODUTO = CB.ID_PRODUTO AND M.CANETA = CB.CANETA AND M.ID_TIPO_BANHO = CB.ID_TIPO_BANHO ' +
         'JOIN ESTOQUE E ON CB.ID_PRODUTO_CODIGO_BARRA = E.ID_PRODUTO_CODIGO_BARRA AND E.ID_CE_ARMAZENADO = ' + IntToStr(conta) +
         ' LEFT JOIN TRANSACAO_PRODUTO T ON M.ID_TRANSACAO_PRODUTO = T.ID_TRANSACAO_PRODUTO ' +
         'LEFT JOIN LOTE L ON T.ID_LOTE_PRODUCAO = L.ID_LOTE ' +
         'LEFT JOIN TRANSACAOPRODUTO TP ON M.ID_TRANSPROD = TP.TPCOD ' +
         'WHERE M.DATA >= ' + SqlData(data1) + ' AND M.DATA < ' + SqlData(data2 + 1) +
         ' AND ID_CEP_MOVIMENTO = ' + IntToStr(conta) +
         ' GROUP BY 1' +
         ' ORDER BY DATA